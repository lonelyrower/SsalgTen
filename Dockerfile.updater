FROM node:24-alpine

WORKDIR /app

# Install required tools. On Alpine, the Compose v2 plugin package is docker-cli-compose
RUN apk add --no-cache \
    bash \
    git \
    curl \
    lsof \
    procps \
    docker-cli \
    docker-cli-compose

# Updater server
COPY scripts/updater-server.mjs /app/updater-server.mjs

ENV PORT=8765 \
    WORKSPACE=/workspace \
    UPDATE_SCRIPT=/workspace/scripts/update-production.sh

EXPOSE 8765

CMD ["node", "/app/updater-server.mjs"]
